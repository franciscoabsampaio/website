<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>Francisco A. B. Sampaio</title>
<link>https://franciscoabsampaio.com/blog.html</link>
<atom:link href="https://franciscoabsampaio.com/blog.xml" rel="self" type="application/rss+xml"/>
<description></description>
<generator>quarto-1.8.26</generator>
<lastBuildDate>Wed, 22 Oct 2025 23:00:00 GMT</lastBuildDate>
<item>
  <title>Tutorial: Reproducible Spark+Delta Tests Without the Hassle</title>
  <link>https://franciscoabsampaio.com/blog/2025-tutorial-spark-connect/</link>
  <description><![CDATA[ 




<blockquote class="blockquote">
<p><strong>Pre-requisite:</strong> if you‚Äôre not familiar with Docker, I recommend you follow the <a href="https://docs.docker.com/get-started/introduction/">official introductory guide</a>.</p>
</blockquote>
<hr>
<p>Setting up a Spark instance can be quite the hassle. Add a data catalog like Delta or Apache Iceberg, and the complexity blows up!</p>
<p>But testing catalog-specific queries against a Spark instance should be easy. And, if you‚Äôre an automation nerd like myself, it should be reproducible, as well.</p>
<p>Unfortunately, the traditional method of installing the OpenJDK, JVM, Spark drivers, Hive plugins, Delta jars is anything but easy, let alone reproducible <em>(As a matter of fact, on the eve of publishing this article, <a href="https://spark.apache.org/docs/latest/api/python/getting_started/index.html">the Live Notebooks on PySpark‚Äôs official quickstart page</a> failed to launch due to a bug downloading OpenJDK‚Ä¶ üòÖ)</em>.</p>
<p>Faced with this problem, I decided to take matters into my own hands ‚Äî and published <a href="https://hub.docker.com/repository/docker/franciscoabsampaio/spark-connect-server">a Docker Hub repository for running Spark Connect servers</a>!</p>
<section id="spark-connect" class="level2">
<h2 class="anchored" data-anchor-id="spark-connect">Spark Connect</h2>
<p>Spark Connect is Apache‚Äôs newest gRPC protocol for Apache Spark. It lets any client that implements the Spark Connect protocol to connect to a Spark Server, and execute workloads seamlessly.</p>
<p>What this Docker container does is take care of all the setup for launching a Spark instance <em>with</em> Spark Connect server, to make the development experience as smooth as possible.</p>
</section>
<section id="running-the-container" class="level2">
<h2 class="anchored" data-anchor-id="running-the-container">Running the Container</h2>
<p>Running it is as straight-forward as any other container. Simply:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">docker</span> run <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p</span> 15002:15002 franciscoabsampaio/spark-connect-server:delta</span></code></pre></div></div>
<p>We use the ‚Äúdelta‚Äù tag if we wish to spin the server with a <a href="https://delta.io/">Delta catalog</a>, and the ‚Äúiceberg‚Äù tag for the <a href="https://iceberg.apache.org/">Iceberg catalog</a>.</p>
<p>The <code>docker run</code> command will pull the image, and start it, resulting in a generous slew of logs, ending with a message akin to ‚Äú<code>Spark Connect server started at 0.0.0.0:15002</code>‚Äù ‚Äî letting us know that the Spark instance is LIVE and ready to accept connections.</p>
<p>Now, connecting to it in PySpark is as easy as:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode numberSource py number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> pyspark.sql <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> SparkSession</span>
<span id="cb2-2"></span>
<span id="cb2-3">spark <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> SparkSession.builder <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb2-4">    .remote(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sc://localhost:15002"</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb2-5">    .getOrCreate()</span>
<span id="cb2-6"></span>
<span id="cb2-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># A simple check:</span></span>
<span id="cb2-8">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> spark.sql(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"SELECT 1 AS id"</span>)</span>
<span id="cb2-9">rows <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df.collect()</span>
<span id="cb2-10"></span>
<span id="cb2-11"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(rows)</span></code></pre></div></div>
<blockquote class="blockquote">
<p><strong>Note:</strong> You may have to install Python packages <code>grpcio</code>, <code>grpcio-status</code> and <code>protobuf</code> for <code>pyspark</code> to connect successfully.</p>
</blockquote>
<p>The Spark session is ON and completely functional for all you development needs.</p>
</section>
<section id="reproducible-tests" class="level2">
<h2 class="anchored" data-anchor-id="reproducible-tests">Reproducible Tests</h2>
<p>If you‚Äôd like to take things a step further, we can manage the Spark server‚Äôs lifecycle entirely in our test suite, ensuring reproducible, specified-in-code, end-to-end dependencies.</p>
<p>To do so, we can create a <a href="https://docs.pytest.org/en/6.2.x/fixture.html">pytest fixture</a>, which is essentially a reusable resource for tests!</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode numberSource py number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> docker</span>
<span id="cb3-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># You can use testcontainers instead of the docker package</span></span>
<span id="cb3-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># but I find it a bit bloated and buggy</span></span>
<span id="cb3-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># when working with custom images.</span></span>
<span id="cb3-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># The docker package is what testcontainers uses</span></span>
<span id="cb3-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># behind the scenes, and I find it more consistent.</span></span>
<span id="cb3-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pytest</span>
<span id="cb3-8"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> time</span>
<span id="cb3-9"></span>
<span id="cb3-10"></span>
<span id="cb3-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Utility function:</span></span>
<span id="cb3-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Once the container has produced the desired message, return.</span></span>
<span id="cb3-13"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> wait_for_log(container, message, timeout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>):</span>
<span id="cb3-14">    start <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> time.time()</span>
<span id="cb3-15">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">while</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>:</span>
<span id="cb3-16">        logs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> container.logs().decode(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"utf-8"</span>)</span>
<span id="cb3-17">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> message <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> logs:</span>
<span id="cb3-18">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span></span>
<span id="cb3-19">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> time.time() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> start <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> timeout:</span>
<span id="cb3-20">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">raise</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">TimeoutError</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Message '</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>message<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">' not found in logs"</span>)</span>
<span id="cb3-21">        time.sleep(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>)</span>
<span id="cb3-22"></span>
<span id="cb3-23"></span>
<span id="cb3-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># The default scope is function,</span></span>
<span id="cb3-25"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># which means the fixture is created and destroyed every test.</span></span>
<span id="cb3-26"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@pytest.fixture</span>(scope<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"function"</span>)</span>
<span id="cb3-27"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> spark_connect_server_url():</span>
<span id="cb3-28">    docker_client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> docker.from_env()</span>
<span id="cb3-29"></span>
<span id="cb3-30">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Let's run a Spark Connect server with a Delta catalog!</span></span>
<span id="cb3-31">    container <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> docker_client.containers.run(</span>
<span id="cb3-32">        image<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"franciscoabsampaio/spark-connect-server:delta"</span>,</span>
<span id="cb3-33">        detach<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>,</span>
<span id="cb3-34">        ports<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'15002/tcp'</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15002</span>}</span>
<span id="cb3-35">    )</span>
<span id="cb3-36">    wait_for_log(container, message<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Spark Connect server started"</span>)</span>
<span id="cb3-37"></span>
<span id="cb3-38">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Pass the connection string to whoever is using the fixture.</span></span>
<span id="cb3-39">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">yield</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sc://localhost:15002"</span></span>
<span id="cb3-40"></span>
<span id="cb3-41">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cleanup</span></span>
<span id="cb3-42">    container.stop()</span></code></pre></div></div>
<p>Now, we can simply pass the fixture to whichever test requires a running Spark Connect server. For example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode numberSource py number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> test_basic_read(spark_connect_server_url):  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Use the fixture</span></span>
<span id="cb4-2">    spark <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> SparkSession.builder <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb4-3">        .remote(spark_connect_server_url) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb4-4">        .getOrCreate()</span>
<span id="cb4-5"></span>
<span id="cb4-6">    table_name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"test_table"</span></span>
<span id="cb4-7"></span>
<span id="cb4-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># CREATE TABLE USING DELTA</span></span>
<span id="cb4-9">    spark.sql(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"""</span></span>
<span id="cb4-10"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        CREATE TABLE </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>table_name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> (</span></span>
<span id="cb4-11"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">            id INT,</span></span>
<span id="cb4-12"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">            name STRING</span></span>
<span id="cb4-13"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        )</span></span>
<span id="cb4-14"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        USING DELTA</span></span>
<span id="cb4-15"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">    """</span>)</span>
<span id="cb4-16"></span>
<span id="cb4-17">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># INSERT INTO TABLE</span></span>
<span id="cb4-18">    spark.sql(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"INSERT INTO </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>table_name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> VALUES (1, 'bird'), (2, 'spark')"</span>)</span>
<span id="cb4-19"></span>
<span id="cb4-20">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># SELECT * FROM TABLE</span></span>
<span id="cb4-21">    df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> spark.sql(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"SELECT * FROM </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>table_name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> ORDER BY id"</span>)</span>
<span id="cb4-22">    rows <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df.collect()</span>
<span id="cb4-23"></span>
<span id="cb4-24">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Test conditions</span></span>
<span id="cb4-25">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">assert</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(rows) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb4-26">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">assert</span> rows[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"id"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb4-27">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">assert</span> rows[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bird"</span></span></code></pre></div></div>
<p>The yield statement locks the fixture execution until the test finishes ‚Äî at which point the cleanup code is executed.</p>
<hr>
<p>And that‚Äôs it ‚Äî you now have a fully reproducible, containerized Spark + Delta test setup, ready to integrate into any CI/CD pipeline or local test suite.</p>
<p>You can find the container on Docker Hub: üëâ <a href="https://hub.docker.com/repository/docker/franciscoabsampaio/spark-connect-server">franciscoabsampaio/spark-connect-server</a></p>
<p>If this saved you time (or frustration), give it a ‚≠êÔ∏è on GitHub or share it with your team ‚Äî and let me know what feature you‚Äôd like supported next!</p>
<p><strong>Happy testing! üöÄ</strong></p>


</section>

 ]]></description>
  <category>spark</category>
  <category>delta</category>
  <category>docker</category>
  <guid>https://franciscoabsampaio.com/blog/2025-tutorial-spark-connect/</guid>
  <pubDate>Wed, 22 Oct 2025 23:00:00 GMT</pubDate>
  <media:content url="https://franciscoabsampaio.com/blog/2025-tutorial-spark-connect/docker_whale.webp" medium="image" type="image/webp"/>
</item>
<item>
  <title>Transformers Maketh LLMs</title>
  <link>https://franciscoabsampaio.com/blog/2025-transformers-maketh-llms/</link>
  <description><![CDATA[ 




<section id="first-a-bit-of-context" class="level2">
<h2 class="anchored" data-anchor-id="first-a-bit-of-context">First, a bit of context</h2>
<p>If you haven‚Äôt been living under a rock, you‚Äôve probably noticed that generative AI is the coolest kid on the block.</p>
<p>Specifically, <em>large language models</em> (or LLMs) have taken the world by storm, due to how powerful they are at - that‚Äôs right - <strong>modelling language</strong>, and <strong>learning from it</strong>.</p>
<p>The language modelling problem is not a new one - <strong>Chomsky pioneered work in language models way back in the 1950s</strong> - and since then (in particular, in the 2000s, following the timely advances in machine learning) people across the world have been trying to invent better ways to model language. The <em>hypothesis</em> was that by learning to accurately model language, computers would gain the ability to perform a series of tasks, due to how expressive and rich with information language intrinsically is.</p>
<p>But because we‚Äôre dealing with computers, we need a way to translate this into bits and bytes, or, at the very least, <strong><em>mathematics</em></strong>. The ‚Äúpopular‚Äù way to formulate the problem of modelling language goes like this:</p>
<blockquote class="blockquote">
<p>What is the probability of a word occurring, given a sequence of words that precedes it?</p>
</blockquote>
<p>Essentially, by learning how to predict the next word that <em>makes sense</em>, a model would, by itself, <em>make sense</em>. For the mathematically-curious, what we‚Äôre essentially doing is trying to determine the function that best models:</p>
<blockquote class="blockquote">
<p>f(?) = P(word_i | {word_0, ‚Ä¶, word_i-1})</p>
</blockquote>
<p>The traditional way would be to find derive a function that accurately models this behaviour - but given the complexity of language, <strong>it‚Äôs near impossible to derive something like this</strong>, and <strong>intractable to solve</strong> (an intractable problem can theoretically be solved, but requires impractical and/or infinite resources to do so).</p>
</section>
<section id="neural-networks" class="level2">
<h2 class="anchored" data-anchor-id="neural-networks">Neural Networks</h2>
<p>Neural networks revolutionised machine learning because they allow scientists to brute-force problems. For the unaware, a neural network is, essentially, a somewhat arbitrary combination of non-linear functions, a collection of layers stacked on top of each other, that take inputs and perform weighted averages on them before passing them on to the next layer.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://franciscoabsampaio.com/blog/2025-transformers-maketh-llms/images/neural_network.png" title="Neural network" class="img-fluid figure-img"></p>
<figcaption>High-level diagram of a neural network.</figcaption>
</figure>
</div>
<blockquote class="blockquote">
<p>The secret ingredient to neural networks is that <strong>every parameter</strong>, be it <strong>how much we weigh each input</strong>, or <strong>how we regulate the non-linearity of each layers</strong> is <strong>learned</strong>.</p>
</blockquote>
<p><strong>‚ÄúLearned‚Äù</strong> is the fancy way of saying the computer tries a bunch of combinations (like, <em>trillions</em> of them) and returns the best result.</p>
<p>As you can imagine, as neural networks grow larger (number of variables in each layer) and deeper (number of layers), this becomes an extremely resource-intensive problem - pre-training GPT4 model required more than <strong>20.000 A100 GPUs</strong> (each of these is like 10-100 times more powerful than your laptop‚Äôs graphic card!) for <strong><em>3 months</em></strong>!</p>
<p>But ChatGPT isn‚Äôt just a neural network - vanilla neural nets are kind of sucky at taking into account long-distance relationships between words (say, the first and last words of this article), and making them better would be extremely expensive (computationally speaking).</p>
</section>
<section id="the-attention-is-all-you-need-paper" class="level2">
<h2 class="anchored" data-anchor-id="the-attention-is-all-you-need-paper">The ‚ÄòAttention Is All You Need‚Äô paper</h2>
<p>In 2017, when attempting to come up with a better model for machine translation (translation done by computers), Vaswani et. al.&nbsp;presented the ‚ÄúTransformer‚Äù architecture in the now famous <a href="https://arxiv.org/abs/1706.03762">‚ÄúAttention Is All You Need‚Äù paper</a>.</p>
<p>The transformer followed the recent introduction of ‚Äúattention‚Äù mechanisms in the field, and took it front and center.</p>
<blockquote class="blockquote">
<p><strong>The attention mechanism is quite intuitive:</strong> (put simply) you take a learned numeric representation of each word in the sequence (roughly speaking, the model assigns a number to each word), and you multiply it by every other learned representation of every word in that sequence (a second learned representation). Then, you weigh a third learned representation of the sequence by the result of this product - essentially <strong>weighing</strong> the sequence by <strong>how much each word is related to each other</strong> in the sequence.</p>
</blockquote>
<p>Because each numeric representation is learned, the model is given <strong><em>full flexibility</em></strong> over <strong>how to represent each word</strong> in this not-so-imaginary numerical space, and <strong>how important any word is relative to each other</strong>!</p>
<p>I say not-so-imaginary numerical space, because if you then take the learned numerical representations of these words, you will find all sorts of quirky relationships! Famously, here‚Äôs the <code>King - Man + Woman = Queen</code>, and a few more (all images were taken from <a href="https://www.youtube.com/watch?v=wjZofJX0v4M">this awesome video by 3Blue1Brown on YouTube</a>):</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://franciscoabsampaio.com/blog/2025-transformers-maketh-llms/images/queen.png" title="Queen" class="img-fluid figure-img"></p>
<figcaption>The learned representation of ‚Äúqueen‚Äù.</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://franciscoabsampaio.com/blog/2025-transformers-maketh-llms/images/tower.png" title="Tower" class="img-fluid figure-img"></p>
<figcaption>Closely related words have proximal representations.</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://franciscoabsampaio.com/blog/2025-transformers-maketh-llms/images/german_sushi.png" title="German sushi" class="img-fluid figure-img"></p>
<figcaption>Likewise, relationships are consistent across many words!</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://franciscoabsampaio.com/blog/2025-transformers-maketh-llms/images/italian_hitler.png" title="Italian Hitler" class="img-fluid figure-img"></p>
<figcaption>üò≥</figcaption>
</figure>
</div>
</section>
<section id="chatgpt" class="level2">
<h2 class="anchored" data-anchor-id="chatgpt">ChatGPT</h2>
<p>The Transformer took the field by storm, and eventually led to ChatGPT, and all these chat assistants we all know.</p>
<p>The GPT models are essentially very large transformers, with some sprinkles on top. Which is why - at its core - <strong>ChatGPT is a very sophisticated auto-complete</strong>, because - following the language modelling reasoning - it‚Äôs simply predicting the next sequence of words, given the user‚Äôs prompt üß†.</p>
<p>There are, of course, <a href="https://openai.com/index/chatgpt/">a few of extra steps that go into making these state-of-the-art word predictors into useful assistants</a>. But it‚Äôs hard to disagree with the statement that the true technical marvel of models like ChatGPT is not the architecture <em>per se</em>, but the sheer dimension of it, which is insanely complex to manage and implement. Not only that, but in order to train a model of this dimension, you need <em>a significant slice</em> of <strong>the entire internet</strong>.</p>
</section>
<section id="life-is-easier-when-you-pay-attention" class="level2">
<h2 class="anchored" data-anchor-id="life-is-easier-when-you-pay-attention">Life is easier when you pay attention</h2>
<p>If you‚Äôve been following me, you probably know I‚Äôve been learning about deep learning (ü§∑) by implementing and training these architectures myself.</p>
<p>To my surprise, working on the transformer was a breeze! It‚Äôs extremely stable during training, and <em>it just works</em>. Just so you understand - <a href="https://www.linkedin.com/pulse/swimming-against-wavenet-francisco-a-b-sampaio-jguvf/?trackingId=30aY9U0oNAZSJQFAbkKnUg%3D%3D&amp;lipi=urn%3Ali%3Apage%3Ad_flagship3_pulse_read%3BBNoYDr%2BbRZ6fBmjGGf0h2g%3D%3D">the last model I implemented - the WaveNet</a> - was the complete opposite: a learning experience, yes, but hell nonetheless. The WaveNet took me many tries over the course of a month to make work <em>decently well</em>.</p>
<p>The transformer? An afternoon.</p>
<p>One difference that stood out is how each architecture models relationships between elements in a sequence - whereas the WaveNet‚Äôs is convoluted and difficult to grasp, <strong><em>transformers just make sense</em></strong>. To me, <strong>attention is a very elegant representation of how words relate to each other</strong>.</p>
<p>So much, that I decided to share it with you üòò</p>
</section>
<section id="next-steps" class="level2">
<h2 class="anchored" data-anchor-id="next-steps">Next steps</h2>
<p>My future posts are likely to be more technical - so for the non-technical readers, I‚Äôm thankful you‚Äôve paid attention. From here, I will take things up a notch, and attempt to build a <strong>BIG (1B+ parameter) model, comparable in size to GPT-2</strong>. Much smaller than what we‚Äôve gotten used to (the original ChatGPT was 175B parameters, and the latest models are estimated to be in the <strong>trillions</strong>!), but big enough to give me a few headaches!</p>
<p>As you can imagine, this is a completely different beast, that will require budgeting (training costs ‚Ç¨‚Ç¨‚Ç¨ üí∏), distributed compute (ü•≥), a lot of preliminary testing, and a few dozen academic papers.</p>
<p>See you soon!</p>


</section>

 ]]></description>
  <category>transformer</category>
  <category>llm</category>
  <category>nlp</category>
  <guid>https://franciscoabsampaio.com/blog/2025-transformers-maketh-llms/</guid>
  <pubDate>Sat, 31 May 2025 23:00:00 GMT</pubDate>
</item>
</channel>
</rss>
